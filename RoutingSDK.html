<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="initial-scale=1, maximum-scale=1, user-scalable=no">
    <title>Lindsay Transit Orange Line</title>
    <style>
      html, body, #viewDiv{
        padding: 0;
        margin: 0;
        height: 100%;
        width: 100%;
      }
      #head{
        height: 90px;
        position: absolute;
        z-index: 1;
        left: 30%;
        background-color: rgba(136, 191, 255, 0.247);
        text-align: center;
      }
      </style>
    <link rel="stylesheet" href="https://js.arcgis.com/4.28/esri/themes/light/main.css">
    <script src="https://js.arcgis.com/4.28/"></script>

    <script>
    require([
      "esri/config",
      "esri/Map",
      "esri/views/MapView",

      "esri/layers/FeatureLayer"
      "esri/layers/graphic"
      "esri/layers/Graphicslayer"
      "esri/layers/route"
      "esri/layers/RouteParameters"

    ], function(esriConfig, Map, MapView, FeatureLayer, graphic, Graphicslayer, route, RouteParameters) {

    //esriConfig.apiKey = "";

    const map = new Map({
      basemap: "oceans"
    });

    const view = new MapView({
      container: "viewDiv",
      map: map,
      center: [-78.753766209999981,44.357250000000079],
      zoom: 12
    });

  // The stops and route result will be stored in this layer
    const routeLayer = new GraphicsLayer();

    // Setup the route parameters
    const routeParams = new RouteParameters({
      // An authorization string used to access the routing service
      apiKey: "AAPKd428b4c3f502464887372fa13874a01c5AdNgFvcLWX03_lCIh5zTL-oHvsfWDoWaOnKHkZHThdCzbE0i8m-cJAbdeESQEl-"
,
      stops: new FeatureSet(),
      outSpatialReference: {
        // autocasts as new SpatialReference()
        wkid: 3857
      }
    });

    // Define the symbology used to display the stops
    const stopSymbol = {
      type: "simple-marker", // autocasts as new SimpleMarkerSymbol()
      style: "cross",
      size: 15,
      outline: {
        // autocasts as new SimpleLineSymbol()
        width: 4
      }
    };

    // Define the symbology used to display the route
    const routeSymbol = {
      type: "simple-line", // autocasts as SimpleLineSymbol()
      color: [0, 0, 255, 0.5],
      width: 5
    };

    // Adds a graphic when the user clicks the map. If 2 or more points exist, route is solved.
    view.on("click", addStop);

    function addStop(event) {
      // Add a point at the location of the map click
      const stop = new Graphic({
        geometry: event.mapPoint,
        symbol: stopSymbol
      });
      routeLayer.add(stop);

      // Execute the route if 2 or more stops are input
      routeParams.stops.features.push(stop);
      if (routeParams.stops.features.length >= 2) {
        route.solve(routeUrl, routeParams).then(showRoute);
      }
    }
    // Adds the solved route to the map as a graphic
    function showRoute(data) {
      const routeResult = data.routeResults[0].route;
      routeResult.symbol = routeSymbol;
      routeLayer.add(routeResult);
    }
    });
  </script>

  </head>
  <body>
        <div id = "head">
          <h1>Routing Orange Line</h1>
        </div>
          

    <div id="viewDiv"></div>
  </body>
</html>
